"use strict";(self.webpackChunkayon_docs=self.webpackChunkayon_docs||[]).push([[8218],{3905:(e,t,n)=>{n.d(t,{Zo:()=>p,kt:()=>h});var a=n(67294);function o(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function r(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function i(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?r(Object(n),!0).forEach((function(t){o(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):r(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function l(e,t){if(null==e)return{};var n,a,o=function(e,t){if(null==e)return{};var n,a,o={},r=Object.keys(e);for(a=0;a<r.length;a++)n=r[a],t.indexOf(n)>=0||(o[n]=e[n]);return o}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(a=0;a<r.length;a++)n=r[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}var s=a.createContext({}),c=function(e){var t=a.useContext(s),n=t;return e&&(n="function"==typeof e?e(t):i(i({},t),e)),n},p=function(e){var t=c(e.components);return a.createElement(s.Provider,{value:t},e.children)},u="mdxType",d={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},m=a.forwardRef((function(e,t){var n=e.components,o=e.mdxType,r=e.originalType,s=e.parentName,p=l(e,["components","mdxType","originalType","parentName"]),u=c(n),m=o,h=u["".concat(s,".").concat(m)]||u[m]||d[m]||r;return n?a.createElement(h,i(i({ref:t},p),{},{components:n})):a.createElement(h,i({ref:t},p))}));function h(e,t){var n=arguments,o=t&&t.mdxType;if("string"==typeof e||o){var r=n.length,i=new Array(r);i[0]=m;var l={};for(var s in t)hasOwnProperty.call(t,s)&&(l[s]=t[s]);l.originalType=e,l[u]="string"==typeof e?e:o,i[1]=l;for(var c=2;c<r;c++)i[c]=n[c];return a.createElement.apply(null,i)}return a.createElement.apply(null,n)}m.displayName="MDXCreateElement"},18679:(e,t,n)=>{n.d(t,{Z:()=>i});var a=n(67294),o=n(86010);const r={tabItem:"tabItem_Ymn6"};function i(e){let{children:t,hidden:n,className:i}=e;return a.createElement("div",{role:"tabpanel",className:(0,o.Z)(r.tabItem,i),hidden:n},t)}},73992:(e,t,n)=>{n.d(t,{Z:()=>k});var a=n(87462),o=n(67294),r=n(86010),i=n(72957),l=n(16550),s=n(75238),c=n(33609),p=n(92560);function u(e){return function(e){return o.Children.map(e,(e=>{if(!e||(0,o.isValidElement)(e)&&function(e){const{props:t}=e;return!!t&&"object"==typeof t&&"value"in t}(e))return e;throw new Error(`Docusaurus error: Bad <Tabs> child <${"string"==typeof e.type?e.type:e.type.name}>: all children of the <Tabs> component should be <TabItem>, and every <TabItem> should have a unique "value" prop.`)}))?.filter(Boolean)??[]}(e).map((e=>{let{props:{value:t,label:n,attributes:a,default:o}}=e;return{value:t,label:n,attributes:a,default:o}}))}function d(e){const{values:t,children:n}=e;return(0,o.useMemo)((()=>{const e=t??u(n);return function(e){const t=(0,c.l)(e,((e,t)=>e.value===t.value));if(t.length>0)throw new Error(`Docusaurus error: Duplicate values "${t.map((e=>e.value)).join(", ")}" found in <Tabs>. Every value needs to be unique.`)}(e),e}),[t,n])}function m(e){let{value:t,tabValues:n}=e;return n.some((e=>e.value===t))}function h(e){let{queryString:t=!1,groupId:n}=e;const a=(0,l.k6)(),r=function(e){let{queryString:t=!1,groupId:n}=e;if("string"==typeof t)return t;if(!1===t)return null;if(!0===t&&!n)throw new Error('Docusaurus error: The <Tabs> component groupId prop is required if queryString=true, because this value is used as the search param name. You can also provide an explicit value such as queryString="my-search-param".');return n??null}({queryString:t,groupId:n});return[(0,s._X)(r),(0,o.useCallback)((e=>{if(!r)return;const t=new URLSearchParams(a.location.search);t.set(r,e),a.replace({...a.location,search:t.toString()})}),[r,a])]}function f(e){const{defaultValue:t,queryString:n=!1,groupId:a}=e,r=d(e),[i,l]=(0,o.useState)((()=>function(e){let{defaultValue:t,tabValues:n}=e;if(0===n.length)throw new Error("Docusaurus error: the <Tabs> component requires at least one <TabItem> children component");if(t){if(!m({value:t,tabValues:n}))throw new Error(`Docusaurus error: The <Tabs> has a defaultValue "${t}" but none of its children has the corresponding value. Available values are: ${n.map((e=>e.value)).join(", ")}. If you intend to show no default tab, use defaultValue={null} instead.`);return t}const a=n.find((e=>e.default))??n[0];if(!a)throw new Error("Unexpected error: 0 tabValues");return a.value}({defaultValue:t,tabValues:r}))),[s,c]=h({queryString:n,groupId:a}),[u,f]=function(e){let{groupId:t}=e;const n=function(e){return e?`docusaurus.tab.${e}`:null}(t),[a,r]=(0,p.Nk)(n);return[a,(0,o.useCallback)((e=>{n&&r.set(e)}),[n,r])]}({groupId:a}),g=(()=>{const e=s??u;return m({value:e,tabValues:r})?e:null})();(0,o.useLayoutEffect)((()=>{g&&l(g)}),[g]);return{selectedValue:i,selectValue:(0,o.useCallback)((e=>{if(!m({value:e,tabValues:r}))throw new Error(`Can't select invalid tab value=${e}`);l(e),c(e),f(e)}),[c,f,r]),tabValues:r}}var g=n(51048);const b={tabList:"tabList__CuJ",tabItem:"tabItem_LNqP"};function v(e){let{className:t,block:n,selectedValue:l,selectValue:s,tabValues:c}=e;const p=[],{blockElementScrollPositionUntilNextRender:u}=(0,i.o5)(),d=e=>{const t=e.currentTarget,n=p.indexOf(t),a=c[n].value;a!==l&&(u(t),s(a))},m=e=>{let t=null;switch(e.key){case"Enter":d(e);break;case"ArrowRight":{const n=p.indexOf(e.currentTarget)+1;t=p[n]??p[0];break}case"ArrowLeft":{const n=p.indexOf(e.currentTarget)-1;t=p[n]??p[p.length-1];break}}t?.focus()};return o.createElement("ul",{role:"tablist","aria-orientation":"horizontal",className:(0,r.Z)("tabs",{"tabs--block":n},t)},c.map((e=>{let{value:t,label:n,attributes:i}=e;return o.createElement("li",(0,a.Z)({role:"tab",tabIndex:l===t?0:-1,"aria-selected":l===t,key:t,ref:e=>p.push(e),onKeyDown:m,onClick:d},i,{className:(0,r.Z)("tabs__item",b.tabItem,i?.className,{"tabs__item--active":l===t})}),n??t)})))}function _(e){let{lazy:t,children:n,selectedValue:a}=e;const r=(Array.isArray(n)?n:[n]).filter(Boolean);if(t){const e=r.find((e=>e.props.value===a));return e?(0,o.cloneElement)(e,{className:"margin-top--md"}):null}return o.createElement("div",{className:"margin-top--md"},r.map(((e,t)=>(0,o.cloneElement)(e,{key:t,hidden:e.props.value!==a}))))}function y(e){const t=f(e);return o.createElement("div",{className:(0,r.Z)("tabs-container",b.tabList)},o.createElement(v,(0,a.Z)({},e,t)),o.createElement(_,(0,a.Z)({},e,t)))}function k(e){const t=(0,g.Z)();return o.createElement(y,(0,a.Z)({key:String(t)},e))}},92704:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>s,contentTitle:()=>i,default:()=>d,frontMatter:()=>r,metadata:()=>l,toc:()=>c});var a=n(87462),o=(n(67294),n(3905));n(73992),n(18679);const r={id:"dev_colorspace",title:"Colorspace Management and Distribution",sidebar_label:"Colorspace"},i=void 0,l={unversionedId:"dev_colorspace",id:"dev_colorspace",title:"Colorspace Management and Distribution",description:"Introduction",source:"@site/docs/dev_colorspace.md",sourceDirName:".",slug:"/dev_colorspace",permalink:"/docs/dev_colorspace",draft:!1,editUrl:"https://github.com/ynput/ayon-documentation/tree/main/website/docs/dev_colorspace.md",tags:[],version:"current",frontMatter:{id:"dev_colorspace",title:"Colorspace Management and Distribution",sidebar_label:"Colorspace"},sidebar:"Dev",previous:{title:"Deadline integration",permalink:"/docs/dev_deadline"},next:{title:"Event system",permalink:"/docs/dev_event_system"}},s={},c=[{value:"Introduction",id:"introduction",level:2},{value:"Data model",id:"data-model",level:2},{value:"Keys",id:"keys",level:3},{value:"Example",id:"example",level:3},{value:"How to integrate it into a host",id:"how-to-integrate-it-into-a-host",level:2}],p={toc:c},u="wrapper";function d(e){let{components:t,...n}=e;return(0,o.kt)(u,(0,a.Z)({},p,n,{components:t,mdxType:"MDXLayout"}),(0,o.kt)("h2",{id:"introduction"},"Introduction"),(0,o.kt)("p",null,"Defines the distribution of colors and OCIO config during publishing. Once colorspace data are captured and integrated into representation loaders could use them for loading image and video data with correct colorspace."),(0,o.kt)("admonition",{title:"Color Management (ImageIO)",type:"warning"},(0,o.kt)("p",{parentName:"admonition"},"Adding the ",(0,o.kt)("inlineCode",{parentName:"p"},"imagio")," settings schema is required for any host or module which is processing pixel data.")),(0,o.kt)("h2",{id:"data-model"},"Data model"),(0,o.kt)("p",null,"Published representations that are extracted with color managed data store a ",(0,o.kt)("strong",{parentName:"p"},"colorspaceData")," entry in its data: ",(0,o.kt)("inlineCode",{parentName:"p"},'representation_doc["data"]["colorspaceData"]'),"."),(0,o.kt)("p",null,"It's up to the Host implementation to pre-configure the application or workfile to have the correct OCIO config applied.\nIt's up to the Extractors to set these values for the representation during publishing.\nIt's up to the Loaders to read these values and apply the correct expected color space."),(0,o.kt)("h3",{id:"keys"},"Keys"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("strong",{parentName:"li"},"colorspace")," - string value used in other publish plugins and loaders"),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("strong",{parentName:"li"},"config")," - storing two versions of path.",(0,o.kt)("ul",{parentName:"li"},(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("strong",{parentName:"li"},"path")," - is formatted and with baked platform root. It is used for possible need to find out where we were sourcing color config during publishing."),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("strong",{parentName:"li"},"template")," - unformatted template resolved from settings. It is used for other plugins targeted to remote publish which could be processed at different platform.")))),(0,o.kt)("h3",{id:"example"},"Example"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},'{\n    "colorspace": "linear",\n    "config": {\n        "path": "/abs/path/to/config.ocio",\n        "template": "{project[root]}/path/to/config.ocio"\n    }\n}\n')),(0,o.kt)("h2",{id:"how-to-integrate-it-into-a-host"},"How to integrate it into a host"),(0,o.kt)("ol",null,(0,o.kt)("li",{parentName:"ol"},"The settings for a host should add the ",(0,o.kt)("inlineCode",{parentName:"li"},"imagio")," schema. Ideally near the top of all categories in its ",(0,o.kt)("inlineCode",{parentName:"li"},"/settings/entities/schemas/system_scheams/host_settings/schema_{host}.json")," so it matches the settings layout other hosts.")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-json"},'{\n    "key": "imageio",\n    "type": "dict",\n    "label": "Color Management (ImageIO)",\n    "is_group": true,\n    "children": [\n        {\n            "type": "schema",\n            "name": "schema_imageio_config"\n        },\n        {\n            "type": "schema",\n            "name": "schema_imageio_file_rules"\n        }\n\n    ]\n}\n')),(0,o.kt)("ol",{start:2},(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("p",{parentName:"li"},"Set the OCIO config path for the host to the path returned from ",(0,o.kt)("inlineCode",{parentName:"p"},"ayon.pipeline.colorspace.get_imageio_config"),", for example:"),(0,o.kt)("ul",{parentName:"li"},(0,o.kt)("li",{parentName:"ul"},"set the ",(0,o.kt)("inlineCode",{parentName:"li"},"OCIO")," environment variable before launching the host via a prelaunch hook"),(0,o.kt)("li",{parentName:"ul"},"or (if the host allows) to set the workfile OCIO config path using the host's API"))),(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("p",{parentName:"li"},"Each Extractor exporting pixel data (e.g. image or video) has to inherit from the mixin class ",(0,o.kt)("inlineCode",{parentName:"p"},"ayon.pipeline.publish.publish_plugins.ColormanagedPyblishPluginMixin")," and use ",(0,o.kt)("inlineCode",{parentName:"p"},"self.set_representation_colorspace")," on the representations to be integrated."))),(0,o.kt)("p",null,"The ",(0,o.kt)("strong",{parentName:"p"},"set_representation_colorspace")," method adds ",(0,o.kt)("inlineCode",{parentName:"p"},"colorspaceData")," to the representation. If the ",(0,o.kt)("inlineCode",{parentName:"p"},"colorspace")," passed is not ",(0,o.kt)("inlineCode",{parentName:"p"},"None")," then it is added directly to the representation with resolved config path otherwise a color space is assumed using the configured file rules. If no file rule matches the ",(0,o.kt)("inlineCode",{parentName:"p"},"colorspaceData")," is ",(0,o.kt)("strong",{parentName:"p"},"not")," added to the representation."),(0,o.kt)("p",null,"An example implementation can be found here: ",(0,o.kt)("inlineCode",{parentName:"p"},"ayon\\hosts\\nuke\\plugins\\publish\\extract_render_local.py")),(0,o.kt)("ol",{start:4},(0,o.kt)("li",{parentName:"ol"},"The Loader plug-ins should take into account the ",(0,o.kt)("inlineCode",{parentName:"li"},"colorspaceData")," in the published representation's data to allow the DCC to read in the expected color space.")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-python"},'from ayon.pipeline.colorspace import (\n    get_imageio_colorspace_from_filepath,\n    get_imageio_config,\n    get_imageio_file_rules\n)\n\nclass YourLoader(api.Loader):\n  def load(self, context, name=None, namespace=None, options=None):\n    path = self.fname\n    colorspace_data = context["representation"]["data"].get("colorspaceData", {})\n    colorspace = (\n      colorspace_data.get("colorspace")\n      # try to match colorspace from file rules\n      or self.get_colorspace_from_file_rules(path, context)\n    )\n\n    # pseudocode\n    load_file(path, colorspace=colorspace)\n\n  def get_colorspace_from_file_rules(self, path, context)\n    project_name = context.data["projectName"]\n    host_name = context.data["hostName"]\n    anatomy_data = context.data["anatomyData"]\n    project_settings_ = context.data["project_settings"]\n\n    config_data = get_imageio_config(\n        project_name, host_name,\n        project_settings=project_settings_,\n        anatomy_data=anatomy_data\n    )\n    file_rules = get_imageio_file_rules(\n        project_name, host_name,\n        project_settings=project_settings_\n    )\n    # get matching colorspace from rules\n    colorspace = get_imageio_colorspace_from_filepath(\n      path, host_name, project_name,\n      config_data=config_data,\n      file_rules=file_rules,\n      project_settings=project_settings\n    )\n')),(0,o.kt)("admonition",{title:"Loading",type:"warning"},(0,o.kt)("p",{parentName:"admonition"},"A custom OCIO config can be set per asset/shot and thus it can happen the current session you are loading into uses a different config than the original context's ",(0,o.kt)("strong",{parentName:"p"},"colorspaceData")," was published with. It's up the loader's implementation to take that into account and decide what to do if the colorspace differs and or might not exist.")))}d.isMDXComponent=!0}}]);