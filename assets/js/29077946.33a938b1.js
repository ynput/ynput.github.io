"use strict";(self.webpackChunkayon_docs=self.webpackChunkayon_docs||[]).push([[4416],{18679:(e,t,n)=>{n.d(t,{Z:()=>o});var r=n(67294),a=n(86010);const s={tabItem:"tabItem_Ymn6"};function o(e){let{children:t,hidden:n,className:o}=e;return r.createElement("div",{role:"tabpanel",className:(0,a.Z)(s.tabItem,o),hidden:n},t)}},73992:(e,t,n)=>{n.d(t,{Z:()=>w});var r=n(87462),a=n(67294),s=n(86010),o=n(72957),i=n(16550),l=n(75238),c=n(33609),u=n(92560);function d(e){return function(e){return a.Children.map(e,(e=>{if(!e||(0,a.isValidElement)(e)&&function(e){const{props:t}=e;return!!t&&"object"==typeof t&&"value"in t}(e))return e;throw new Error(`Docusaurus error: Bad <Tabs> child <${"string"==typeof e.type?e.type:e.type.name}>: all children of the <Tabs> component should be <TabItem>, and every <TabItem> should have a unique "value" prop.`)}))?.filter(Boolean)??[]}(e).map((e=>{let{props:{value:t,label:n,attributes:r,default:a}}=e;return{value:t,label:n,attributes:r,default:a}}))}function p(e){const{values:t,children:n}=e;return(0,a.useMemo)((()=>{const e=t??d(n);return function(e){const t=(0,c.l)(e,((e,t)=>e.value===t.value));if(t.length>0)throw new Error(`Docusaurus error: Duplicate values "${t.map((e=>e.value)).join(", ")}" found in <Tabs>. Every value needs to be unique.`)}(e),e}),[t,n])}function m(e){let{value:t,tabValues:n}=e;return n.some((e=>e.value===t))}function v(e){let{queryString:t=!1,groupId:n}=e;const r=(0,i.k6)(),s=function(e){let{queryString:t=!1,groupId:n}=e;if("string"==typeof t)return t;if(!1===t)return null;if(!0===t&&!n)throw new Error('Docusaurus error: The <Tabs> component groupId prop is required if queryString=true, because this value is used as the search param name. You can also provide an explicit value such as queryString="my-search-param".');return n??null}({queryString:t,groupId:n});return[(0,l._X)(s),(0,a.useCallback)((e=>{if(!s)return;const t=new URLSearchParams(r.location.search);t.set(s,e),r.replace({...r.location,search:t.toString()})}),[s,r])]}function h(e){const{defaultValue:t,queryString:n=!1,groupId:r}=e,s=p(e),[o,i]=(0,a.useState)((()=>function(e){let{defaultValue:t,tabValues:n}=e;if(0===n.length)throw new Error("Docusaurus error: the <Tabs> component requires at least one <TabItem> children component");if(t){if(!m({value:t,tabValues:n}))throw new Error(`Docusaurus error: The <Tabs> has a defaultValue "${t}" but none of its children has the corresponding value. Available values are: ${n.map((e=>e.value)).join(", ")}. If you intend to show no default tab, use defaultValue={null} instead.`);return t}const r=n.find((e=>e.default))??n[0];if(!r)throw new Error("Unexpected error: 0 tabValues");return r.value}({defaultValue:t,tabValues:s}))),[l,c]=v({queryString:n,groupId:r}),[d,h]=function(e){let{groupId:t}=e;const n=function(e){return e?`docusaurus.tab.${e}`:null}(t),[r,s]=(0,u.Nk)(n);return[r,(0,a.useCallback)((e=>{n&&s.set(e)}),[n,s])]}({groupId:r}),f=(()=>{const e=l??d;return m({value:e,tabValues:s})?e:null})();(0,a.useLayoutEffect)((()=>{f&&i(f)}),[f]);return{selectedValue:o,selectValue:(0,a.useCallback)((e=>{if(!m({value:e,tabValues:s}))throw new Error(`Can't select invalid tab value=${e}`);i(e),c(e),h(e)}),[c,h,s]),tabValues:s}}var f=n(51048);const b={tabList:"tabList__CuJ",tabItem:"tabItem_LNqP"};function k(e){let{className:t,block:n,selectedValue:i,selectValue:l,tabValues:c}=e;const u=[],{blockElementScrollPositionUntilNextRender:d}=(0,o.o5)(),p=e=>{const t=e.currentTarget,n=u.indexOf(t),r=c[n].value;r!==i&&(d(t),l(r))},m=e=>{let t=null;switch(e.key){case"Enter":p(e);break;case"ArrowRight":{const n=u.indexOf(e.currentTarget)+1;t=u[n]??u[0];break}case"ArrowLeft":{const n=u.indexOf(e.currentTarget)-1;t=u[n]??u[u.length-1];break}}t?.focus()};return a.createElement("ul",{role:"tablist","aria-orientation":"horizontal",className:(0,s.Z)("tabs",{"tabs--block":n},t)},c.map((e=>{let{value:t,label:n,attributes:o}=e;return a.createElement("li",(0,r.Z)({role:"tab",tabIndex:i===t?0:-1,"aria-selected":i===t,key:t,ref:e=>u.push(e),onKeyDown:m,onClick:p},o,{className:(0,s.Z)("tabs__item",b.tabItem,o?.className,{"tabs__item--active":i===t})}),n??t)})))}function y(e){let{lazy:t,children:n,selectedValue:r}=e;const s=(Array.isArray(n)?n:[n]).filter(Boolean);if(t){const e=s.find((e=>e.props.value===r));return e?(0,a.cloneElement)(e,{className:"margin-top--md"}):null}return a.createElement("div",{className:"margin-top--md"},s.map(((e,t)=>(0,a.cloneElement)(e,{key:t,hidden:e.props.value!==r}))))}function g(e){const t=h(e);return a.createElement("div",{className:(0,s.Z)("tabs-container",b.tabList)},a.createElement(k,(0,r.Z)({},e,t)),a.createElement(y,(0,r.Z)({},e,t)))}function w(e){const t=(0,f.Z)();return a.createElement(g,(0,r.Z)({key:String(t)},e))}},55134:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>l,contentTitle:()=>o,default:()=>p,frontMatter:()=>s,metadata:()=>i,toc:()=>c});var r=n(87462),a=(n(67294),n(3905));n(73992),n(18679);const s={id:"admin_server_services",title:"Ayon services",sidebar_label:"Services"},o=void 0,i={unversionedId:"admin_server_services",id:"admin_server_services",title:"Ayon services",description:"Ayon services are independent processes provided by addons that run in Docker containers outside of the main Ayon stack.",source:"@site/docs/admin_server_services.md",sourceDirName:".",slug:"/admin_server_services",permalink:"/docs/admin_server_services",draft:!1,editUrl:"https://github.com/ynput/ayon-documentation/tree/main/website/docs/admin_server_services.md",tags:[],version:"current",frontMatter:{id:"admin_server_services",title:"Ayon services",sidebar_label:"Services"},sidebar:"Admin",previous:{title:"Provisioning",permalink:"/docs/admin_server_provisioning"},next:{title:"Configuring email",permalink:"/docs/admin_server_email"}},l={},c=[{value:"Service account",id:"service-account",level:2},{value:"ASH",id:"ash",level:2},{value:"Setting up using docker compose",id:"setting-up-using-docker-compose",level:3},{value:"Troubleshooting",id:"troubleshooting",level:2},{value:"Handling Failed Services",id:"handling-failed-services",level:3}],u={toc:c},d="wrapper";function p(e){let{components:t,...n}=e;return(0,a.kt)(d,(0,r.Z)({},u,n,{components:t,mdxType:"MDXLayout"}),(0,a.kt)("p",null,"Ayon services are independent processes provided by addons that run in Docker containers outside of the main Ayon stack.\nThese services connect to the server using the HTTP API and perform various tasks in the background.\nSince they are not directly connected to the database but use the API, it is safe to run services even on different premises.\nThis can be beneficial, for example, when the Ayon server is running in a public cloud while several services run on-premises."),(0,a.kt)("h2",{id:"service-account"},"Service account"),(0,a.kt)("p",null,"Ensure you have a service account with API key.\nYou can create a service account using either the provisioning file (",(0,a.kt)("inlineCode",{parentName:"p"},"settings/template.json"),") or the web interface."),(0,a.kt)("p",null,"template.json"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-json"},'  {\n      "name": "service",\n      "apiKey": "veryinsecureapikey",\n      "isService": true\n  }\n')),(0,a.kt)("h2",{id:"ash"},"ASH"),(0,a.kt)("p",null,"To run a managed service (controllable from the web interface), the worker machine needs to run the Ayon Service Host (ASH).\nASH is a small process that handles spawning services as specified by the administrator in the services page.\nIt periodically checks the services declared in the Ayon server database and starts them if they are not\nrunning. It also provides a simple API for services to report their status and to receive configuration."),(0,a.kt)("h3",{id:"setting-up-using-docker-compose"},"Setting up using docker compose"),(0,a.kt)("p",null,"To add ASH as a service to your ",(0,a.kt)("inlineCode",{parentName:"p"},"docker-compose.yml")," file, you can either use the same stack as the server\nor create a completely separate one. "),(0,a.kt)("p",null,"You need to provide the ",(0,a.kt)("inlineCode",{parentName:"p"},"AYON_API_KEY")," and ",(0,a.kt)("inlineCode",{parentName:"p"},"AYON_SERVER_URL")," environment variables.\nAdditionally, ASH requires the ",(0,a.kt)("inlineCode",{parentName:"p"},"docker.sock")," file to be mounted as a volume to control the Docker process and spawn services."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-yaml"},'worker:                                                                                                                           \n  image: ynput/ayon-ash:latest\n  hostname: worker01\n  restart: unless-stopped\n  volumes:\n    - "/var/run/docker.sock:/var/run/docker.sock"\n  environment:\n    - "AYON_API_KEY=veryinsecureapikey"\n    - "AYON_SERVER_URL=https://ayon.example.com"\n')),(0,a.kt)("h2",{id:"troubleshooting"},"Troubleshooting"),(0,a.kt)("h3",{id:"handling-failed-services"},"Handling Failed Services"),(0,a.kt)("p",null,"In case a service fails to stop and remove its container, you may need to manually intervene to stop the orphaned containers."),(0,a.kt)("p",null,"Ayon service containers are easily identifiable by their naming convention.\nThey use the service name with an ",(0,a.kt)("inlineCode",{parentName:"p"},"aysvc_")," prefix.\nThis prefix allows you to quickly filter and manage Ayon service containers when working with Docker commands."),(0,a.kt)("p",null,"Run the following command to list all running Docker containers and filter the results to display only Ayon service containers."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},'$ docker ps | grep aysvc\naf60516ccb4b   ynput/ayon-openpype-import:latest   "python -m processor"    2 weeks ago    Up 2 weeks   aysvc_op3import\n')),(0,a.kt)("p",null,"Once you've identified the orphaned service containers, use the ",(0,a.kt)("inlineCode",{parentName:"p"},"docker stop")," command to stop them individually.\nReplace ",(0,a.kt)("inlineCode",{parentName:"p"},"<container_id>")," with the actual container ID of the orphaned container:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},"docker stop <container_id>\n")),(0,a.kt)("p",null,"Since the containers are started with the ",(0,a.kt)("inlineCode",{parentName:"p"},"--remove")," flag, they will be automatically removed once they are stopped."))}p.isMDXComponent=!0}}]);