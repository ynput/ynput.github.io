"use strict";(self.webpackChunkayon_docs=self.webpackChunkayon_docs||[]).push([[1732],{18679:(e,t,n)=>{n.d(t,{Z:()=>i});var a=n(67294),r=n(86010);const o={tabItem:"tabItem_Ymn6"};function i(e){let{children:t,hidden:n,className:i}=e;return a.createElement("div",{role:"tabpanel",className:(0,r.Z)(o.tabItem,i),hidden:n},t)}},73992:(e,t,n)=>{n.d(t,{Z:()=>g});var a=n(87462),r=n(67294),o=n(86010),i=n(72957),l=n(16550),u=n(75238),d=n(33609),s=n(92560);function p(e){return function(e){return r.Children.map(e,(e=>{if(!e||(0,r.isValidElement)(e)&&function(e){const{props:t}=e;return!!t&&"object"==typeof t&&"value"in t}(e))return e;throw new Error(`Docusaurus error: Bad <Tabs> child <${"string"==typeof e.type?e.type:e.type.name}>: all children of the <Tabs> component should be <TabItem>, and every <TabItem> should have a unique "value" prop.`)}))?.filter(Boolean)??[]}(e).map((e=>{let{props:{value:t,label:n,attributes:a,default:r}}=e;return{value:t,label:n,attributes:a,default:r}}))}function c(e){const{values:t,children:n}=e;return(0,r.useMemo)((()=>{const e=t??p(n);return function(e){const t=(0,d.l)(e,((e,t)=>e.value===t.value));if(t.length>0)throw new Error(`Docusaurus error: Duplicate values "${t.map((e=>e.value)).join(", ")}" found in <Tabs>. Every value needs to be unique.`)}(e),e}),[t,n])}function m(e){let{value:t,tabValues:n}=e;return n.some((e=>e.value===t))}function k(e){let{queryString:t=!1,groupId:n}=e;const a=(0,l.k6)(),o=function(e){let{queryString:t=!1,groupId:n}=e;if("string"==typeof t)return t;if(!1===t)return null;if(!0===t&&!n)throw new Error('Docusaurus error: The <Tabs> component groupId prop is required if queryString=true, because this value is used as the search param name. You can also provide an explicit value such as queryString="my-search-param".');return n??null}({queryString:t,groupId:n});return[(0,u._X)(o),(0,r.useCallback)((e=>{if(!o)return;const t=new URLSearchParams(a.location.search);t.set(o,e),a.replace({...a.location,search:t.toString()})}),[o,a])]}function h(e){const{defaultValue:t,queryString:n=!1,groupId:a}=e,o=c(e),[i,l]=(0,r.useState)((()=>function(e){let{defaultValue:t,tabValues:n}=e;if(0===n.length)throw new Error("Docusaurus error: the <Tabs> component requires at least one <TabItem> children component");if(t){if(!m({value:t,tabValues:n}))throw new Error(`Docusaurus error: The <Tabs> has a defaultValue "${t}" but none of its children has the corresponding value. Available values are: ${n.map((e=>e.value)).join(", ")}. If you intend to show no default tab, use defaultValue={null} instead.`);return t}const a=n.find((e=>e.default))??n[0];if(!a)throw new Error("Unexpected error: 0 tabValues");return a.value}({defaultValue:t,tabValues:o}))),[u,d]=k({queryString:n,groupId:a}),[p,h]=function(e){let{groupId:t}=e;const n=function(e){return e?`docusaurus.tab.${e}`:null}(t),[a,o]=(0,s.Nk)(n);return[a,(0,r.useCallback)((e=>{n&&o.set(e)}),[n,o])]}({groupId:a}),v=(()=>{const e=u??p;return m({value:e,tabValues:o})?e:null})();(0,r.useLayoutEffect)((()=>{v&&l(v)}),[v]);return{selectedValue:i,selectValue:(0,r.useCallback)((e=>{if(!m({value:e,tabValues:o}))throw new Error(`Can't select invalid tab value=${e}`);l(e),d(e),h(e)}),[d,h,o]),tabValues:o}}var v=n(51048);const y={tabList:"tabList__CuJ",tabItem:"tabItem_LNqP"};function N(e){let{className:t,block:n,selectedValue:l,selectValue:u,tabValues:d}=e;const s=[],{blockElementScrollPositionUntilNextRender:p}=(0,i.o5)(),c=e=>{const t=e.currentTarget,n=s.indexOf(t),a=d[n].value;a!==l&&(p(t),u(a))},m=e=>{let t=null;switch(e.key){case"Enter":c(e);break;case"ArrowRight":{const n=s.indexOf(e.currentTarget)+1;t=s[n]??s[0];break}case"ArrowLeft":{const n=s.indexOf(e.currentTarget)-1;t=s[n]??s[s.length-1];break}}t?.focus()};return r.createElement("ul",{role:"tablist","aria-orientation":"horizontal",className:(0,o.Z)("tabs",{"tabs--block":n},t)},d.map((e=>{let{value:t,label:n,attributes:i}=e;return r.createElement("li",(0,a.Z)({role:"tab",tabIndex:l===t?0:-1,"aria-selected":l===t,key:t,ref:e=>s.push(e),onKeyDown:m,onClick:c},i,{className:(0,o.Z)("tabs__item",y.tabItem,i?.className,{"tabs__item--active":l===t})}),n??t)})))}function f(e){let{lazy:t,children:n,selectedValue:a}=e;const o=(Array.isArray(n)?n:[n]).filter(Boolean);if(t){const e=o.find((e=>e.props.value===a));return e?(0,r.cloneElement)(e,{className:"margin-top--md"}):null}return r.createElement("div",{className:"margin-top--md"},o.map(((e,t)=>(0,r.cloneElement)(e,{key:t,hidden:e.props.value!==a}))))}function b(e){const t=h(e);return r.createElement("div",{className:(0,o.Z)("tabs-container",y.tabList)},r.createElement(N,(0,a.Z)({},e,t)),r.createElement(f,(0,a.Z)({},e,t)))}function g(e){const t=(0,v.Z)();return r.createElement(b,(0,a.Z)({key:String(t)},e))}},86229:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>s,contentTitle:()=>u,default:()=>k,frontMatter:()=>l,metadata:()=>d,toc:()=>p});var a=n(87462),r=(n(67294),n(3905)),o=n(20398),i=n(87006);n(73992),n(18679);const l={id:"addon_aquarium_developer",title:"Aquarium",sidebar_label:"Aquarium"},u=void 0,d={unversionedId:"addon_aquarium_developer",id:"addon_aquarium_developer",title:"Aquarium",description:"{versions.Aquarium_Badge}",source:"@site/docs/addon_aquarium_developer.md",sourceDirName:".",slug:"/addon_aquarium_developer",permalink:"/docs/addon_aquarium_developer",draft:!1,editUrl:"https://github.com/ynput/ayon-documentation/tree/main/website/docs/addon_aquarium_developer.md",tags:[],version:"current",frontMatter:{id:"addon_aquarium_developer",title:"Aquarium",sidebar_label:"Aquarium"},sidebar:"Dev",previous:{title:"Event system",permalink:"/docs/dev_event_system"}},s={},p=[{value:"Introduction",id:"introduction",level:2},{value:"Code structure",id:"code-structure",level:2},{value:"Directory",id:"directory",level:3},{value:"Client",id:"client",level:4},{value:"Server",id:"server",level:4},{value:"Frontend",id:"frontend",level:5},{value:"Services",id:"services",level:4},{value:"Developer environment",id:"developer-environment",level:2},{value:"Requirements",id:"requirements",level:3},{value:"Optional requirements",id:"optional-requirements",level:3},{value:"Setup your dev environment",id:"setup-your-dev-environment",level:3},{value:"1. Start Ayon",id:"1-start-ayon",level:4},{value:"2. Create a service user",id:"2-create-a-service-user",level:4},{value:"3. Upload addon to Ayon",id:"3-upload-addon-to-ayon",level:4},{value:"4. Create a dev bundle",id:"4-create-a-dev-bundle",level:4},{value:"5. Build Ayon dependencies",id:"5-build-ayon-dependencies",level:4},{value:"6. Update bundle dependencies",id:"6-update-bundle-dependencies",level:4}],c={toc:p},m="wrapper";function k(e){let{components:t,...l}=e;return(0,r.kt)(m,(0,a.Z)({},c,l,{components:t,mdxType:"MDXLayout"}),(0,r.kt)(o.D,{mdxType:"ReactMarkdown"},i.V_),(0,r.kt)("p",null,(0,r.kt)("img",{alt:"Aquarium addon for Ayon",src:n(45498).Z,width:"215",height:"200"})),(0,r.kt)("h2",{id:"introduction"},"Introduction"),(0,r.kt)("p",null,"Welcome in the developer documentation of Aquarium addon and thanks for looking into it."),(0,r.kt)("p",null,"This documentation is here to provide information on :"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#code-structure"},"How this code is structured")," ?"),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#developer-environment"},"How to setup your developer environment")," ?")),(0,r.kt)("admonition",{type:"info"},(0,r.kt)("p",{parentName:"admonition"},"Disclaimer: We are new developers into Ayon's ecosystem.\nThe following documentation might require some improvements and we may have missed steps.\nFeel free to update this file or directly reach us at ",(0,r.kt)("a",{parentName:"p",href:"mailto:support@fatfi.sh"},"support@fatfi.sh"))),(0,r.kt)("h2",{id:"code-structure"},"Code structure"),(0,r.kt)("p",null,"This addon is composed by 3 main parts:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#client"},"Client")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#server"},"Server"),(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},"API"),(0,r.kt)("li",{parentName:"ul"},"Frontend"))),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#services"},"Services"),(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},"Leecher"),(0,r.kt)("li",{parentName:"ul"},"Processor")))),(0,r.kt)("h3",{id:"directory"},"Directory"),(0,r.kt)("h4",{id:"client"},"Client"),(0,r.kt)("p",null,"Client code is used in the ",(0,r.kt)("a",{parentName:"p",href:"https://github.com/ynput/ayon-launcher"},"Ayon Launcher"),", the AYON pipeline desktop application."),(0,r.kt)("admonition",{type:"info"},(0,r.kt)("p",{parentName:"admonition"},"The client integration is not finished yet.")),(0,r.kt)("p",null,"This client integration allow you to"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Authenticate the user"),(0,r.kt)("li",{parentName:"ul"},"Publish media")),(0,r.kt)("h4",{id:"server"},"Server"),(0,r.kt)("p",null,"Python server-side part of the addon. It's mainly used to declare specific addon API endpoints, used by the leecher and processor services to keep your data in sync."),(0,r.kt)("p",null,"It's also responsible to declare specific addon settings, in your Ayon server and project settings."),(0,r.kt)("h5",{id:"frontend"},"Frontend"),(0,r.kt)("p",null,"This folder is used to provide a web UI in your Ayon settings to pair projects between Ayon and Aquarium and also to trigger a full project sync."),(0,r.kt)("h4",{id:"services"},"Services"),(0,r.kt)("p",null,"Syncing data between Ayon and Aquarium relies on ",(0,r.kt)("a",{parentName:"p",href:"/docs/dev_event_system"},"Ayon services system"),"."),(0,r.kt)("p",null,"This addon use two services:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"Leecher"),(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},"It's listening Aquarium's events, and store them into Ayon database for async processing."))),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"Processor"),(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},"It's looking for specific Aquarium events in Ayon's database and process them to transform data into compatible Ayon's structure and send request to addon server API endpoints to interact with the server.")))),(0,r.kt)("h2",{id:"developer-environment"},"Developer environment"),(0,r.kt)("h3",{id:"requirements"},"Requirements"),(0,r.kt)("p",null,"You will need to clone several Ayon repositories in order to run everything locally:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"You need to ",(0,r.kt)("a",{parentName:"li",href:"https://docs.docker.com/engine/install/"},"install Docker")," first."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"https://github.com/ynput/ayon-docker"},"Ayon Docker")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"https://github.com/ynput/ayon-core"},"Ayon Core"),(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},"You can clone this one, into ",(0,r.kt)("inlineCode",{parentName:"li"},"ayon-docker/addons/core")," folder. Here is the steps :\n2. From the ",(0,r.kt)("inlineCode",{parentName:"li"},"core")," folder execute this command:",(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"git clone ssh://git@github.com:ynput/ayon-core.git dev")),(0,r.kt)("li",{parentName:"ul"},"This command will clone the repository and rename it ",(0,r.kt)("inlineCode",{parentName:"li"},"dev"),", in order to follow ",(0,r.kt)("a",{parentName:"li",href:"/docs/admin_server_installing_addons#directory-structure"},"Ayon addon directory structure")))))),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"https://github.com/ynput/ayon-dependencies-tool"},"Ayon dependencies")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"https://github.com/ynput/ayon-aquarium"},"Aquarium addon"),(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},"You can clone this one, into ",(0,r.kt)("inlineCode",{parentName:"li"},"ayon-docker/addons")," folder. Here is the steps :",(0,r.kt)("ol",{parentName:"li"},(0,r.kt)("li",{parentName:"ol"},"Create a folder ",(0,r.kt)("inlineCode",{parentName:"li"},"ayon-aquarium")," in ",(0,r.kt)("inlineCode",{parentName:"li"},"ayon-docker/addons")," folder"),(0,r.kt)("li",{parentName:"ol"},"From the ",(0,r.kt)("inlineCode",{parentName:"li"},"ayon-aquarium")," folder execute this command:",(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"git clone ssh://git@github.com:ynput/ayon-aquarium.git dev")),(0,r.kt)("li",{parentName:"ul"},"This command will clone the repository and rename it ",(0,r.kt)("inlineCode",{parentName:"li"},"dev"),", in order to follow ",(0,r.kt)("a",{parentName:"li",href:"/docs/admin_server_installing_addons#directory-structure"},"Ayon addon directory structure"))))))))),(0,r.kt)("h3",{id:"optional-requirements"},"Optional requirements"),(0,r.kt)("p",null,"If you are looking for Python type checking, you will need extra steps:"),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},"Clone ",(0,r.kt)("a",{parentName:"li",href:"https://github.com/ynput/ayon-backend"},"Ayon Backend")," repository"),(0,r.kt)("li",{parentName:"ol"},"Clone ",(0,r.kt)("a",{parentName:"li",href:"https://github.com/fatfish-lab/aquarium-python-api"},"Aquarium python API")),(0,r.kt)("li",{parentName:"ol"},"Create a new pyenv dedicated for development ",(0,r.kt)("inlineCode",{parentName:"li"},"pyenv virtualenv ayondevaquarium")," using python 3.10.12"),(0,r.kt)("li",{parentName:"ol"},"Enable your pyenv ",(0,r.kt)("inlineCode",{parentName:"li"},"pyenv shell ayondevaquarium")," and/or select this pyenv in your IDE."),(0,r.kt)("li",{parentName:"ol"},"Install dependencies from your local repositories",(0,r.kt)("ol",{parentName:"li"},(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("inlineCode",{parentName:"li"},"python -m pip install -e /path/to/aquarium-python-api")),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("inlineCode",{parentName:"li"},"python -m pip install -e /path/to/ayon-backend"))))),(0,r.kt)("h3",{id:"setup-your-dev-environment"},"Setup your dev environment"),(0,r.kt)("h4",{id:"1-start-ayon"},"1. Start Ayon"),(0,r.kt)("p",null,"Start your Ayon instances, from the Ayon Docker repository, using the command ",(0,r.kt)("inlineCode",{parentName:"p"},"docker compose up --build"),". For a more precise steps, check out the ",(0,r.kt)("a",{parentName:"p",href:"https://github.com/ynput/ayon-docker"},"repository README file"),"."),(0,r.kt)("h4",{id:"2-create-a-service-user"},"2. Create a service user"),(0,r.kt)("p",null,"To interact with Ayon server, we need to create a service User."),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},"On your Ayon server, create a service user from ",(0,r.kt)("inlineCode",{parentName:"li"},"Studio settings")," > ",(0,r.kt)("inlineCode",{parentName:"li"},"Users")," tab > ",(0,r.kt)("inlineCode",{parentName:"li"},"Add new user"),". Choose ",(0,r.kt)("inlineCode",{parentName:"li"},"Service")," in the access level section."),(0,r.kt)("li",{parentName:"ol"},"On the newly created Service User, generate an API Key.",(0,r.kt)("ol",{parentName:"li"},(0,r.kt)("li",{parentName:"ol"},"Keep that API key, we will use it later.")))),(0,r.kt)("h4",{id:"3-upload-addon-to-ayon"},"3. Upload addon to Ayon"),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},"From your ",(0,r.kt)("inlineCode",{parentName:"li"},"ayon-aquarium")," folder, execute the file ",(0,r.kt)("inlineCode",{parentName:"li"},"create_package.py")),(0,r.kt)("li",{parentName:"ol"},"Locate the ",(0,r.kt)("inlineCode",{parentName:"li"},".zip")," file created in the new folder ",(0,r.kt)("inlineCode",{parentName:"li"},"package")),(0,r.kt)("li",{parentName:"ol"},"From Ayon server web interface, go to ",(0,r.kt)("inlineCode",{parentName:"li"},"Studio settings")," > ",(0,r.kt)("inlineCode",{parentName:"li"},"Bundles")," tab."),(0,r.kt)("li",{parentName:"ol"},"Click on the button ",(0,r.kt)("inlineCode",{parentName:"li"},"Install addon")," and upload your previous ",(0,r.kt)("inlineCode",{parentName:"li"},".zip")," file."),(0,r.kt)("li",{parentName:"ol"},"Restart your Ayon server")),(0,r.kt)("h4",{id:"4-create-a-dev-bundle"},"4. Create a dev bundle"),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},"From the ",(0,r.kt)("inlineCode",{parentName:"li"},"Studio settings")," > ",(0,r.kt)("inlineCode",{parentName:"li"},"Bundles")," tab, create a new bundle ",(0,r.kt)("inlineCode",{parentName:"li"},"aquarium-dev")," (choose the name you want)"),(0,r.kt)("li",{parentName:"ol"},"Assign your self as a developer on this bundle"),(0,r.kt)("li",{parentName:"ol"},"Locate ",(0,r.kt)("inlineCode",{parentName:"li"},"aquarium")," line in the addon list, and select the version where you have a ",(0,r.kt)("inlineCode",{parentName:"li"},"+git")," at the end."),(0,r.kt)("li",{parentName:"ol"},"Enable addon directory and paste the location of the client folder ",(0,r.kt)("inlineCode",{parentName:"li"},"ayon-docker/addons/ayon-aquarium/dev/client")),(0,r.kt)("li",{parentName:"ol"},"Locate ",(0,r.kt)("inlineCode",{parentName:"li"},"core")," line in the addon list, and select the version where you have a ",(0,r.kt)("inlineCode",{parentName:"li"},"+git")," at the end."),(0,r.kt)("li",{parentName:"ol"},"Enable addon directory and paste the location of the client folder ",(0,r.kt)("inlineCode",{parentName:"li"},"ayon-docker/addons/core/dev/client")),(0,r.kt)("li",{parentName:"ol"},"Don't forget to save your dev bundle by clicking on the top right button ",(0,r.kt)("inlineCode",{parentName:"li"},"Save bundle"))),(0,r.kt)("h4",{id:"5-build-ayon-dependencies"},"5. Build Ayon dependencies"),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},"From the Ayon dependencies repository folder, copy the file ",(0,r.kt)("inlineCode",{parentName:"li"},"example_env")," as ",(0,r.kt)("inlineCode",{parentName:"li"},".env")," file."),(0,r.kt)("li",{parentName:"ol"},"Edit this file and add your local Ayon dev server URL and your previously generated service API key."),(0,r.kt)("li",{parentName:"ol"},"Run the command ",(0,r.kt)("inlineCode",{parentName:"li"},"./start install")),(0,r.kt)("li",{parentName:"ol"},"Run the command ",(0,r.kt)("inlineCode",{parentName:"li"},"./start create -b aquarium-dev")," (Use the name of the previously bundle you created)",(0,r.kt)("ol",{parentName:"li"},(0,r.kt)("li",{parentName:"ol"},"This command will create and upload the dependencies to your Ayon server")))),(0,r.kt)("h4",{id:"6-update-bundle-dependencies"},"6. Update bundle dependencies"),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},"From the ",(0,r.kt)("inlineCode",{parentName:"li"},"Studio settings")," > ",(0,r.kt)("inlineCode",{parentName:"li"},"Bundles")," tab, select your ",(0,r.kt)("inlineCode",{parentName:"li"},"aquarium-dev")," bundle."),(0,r.kt)("li",{parentName:"ol"},"In the right panel, locate the section ",(0,r.kt)("inlineCode",{parentName:"li"},"Dependency Packages")),(0,r.kt)("li",{parentName:"ol"},"Edit dependencies of your OS to select the latest upload dependencies")),(0,r.kt)("hr",null),(0,r.kt)("p",null,"Congratulations, you are now good to go developing ! \ud83c\udf89"),(0,r.kt)("admonition",{type:"tip"},(0,r.kt)("p",{parentName:"admonition"},"Don't forget to restart your Ayon server if you work on the server part, it's the only way to take your modification in consideration.")))}k.isMDXComponent=!0},45498:(e,t,n)=>{n.d(t,{Z:()=>a});const a=n.p+"assets/images/aquarium-ayon-logo-7705a9e9e02556045179f647f0112b7b.png"}}]);