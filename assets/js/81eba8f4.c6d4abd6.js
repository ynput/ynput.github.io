"use strict";(self.webpackChunkayon_docs=self.webpackChunkayon_docs||[]).push([[7491],{37133:(e,t,a)=>{a.r(t),a.d(t,{assets:()=>r,contentTitle:()=>o,default:()=>p,frontMatter:()=>s,metadata:()=>l,toc:()=>c});var n=a(87462),i=(a(67294),a(3905));const s={id:"addon_keycloak_admin",title:"Keycloak Admin Docs",sidebar_label:"Keycloak"},o=void 0,l={unversionedId:"addon_keycloak_admin",id:"addon_keycloak_admin",title:"Keycloak Admin Docs",description:"Keycloak addon provides SSO for Ayon using Keycloak (https://keycloak.org).",source:"@site/docs/addon_keycloak_admin.md",sourceDirName:".",slug:"/addon_keycloak_admin",permalink:"/docs/addon_keycloak_admin",draft:!1,editUrl:"https://github.com/ynput/ayon-documentation/tree/main/website/docs/addon_keycloak_admin.md",tags:[],version:"current",frontMatter:{id:"addon_keycloak_admin",title:"Keycloak Admin Docs",sidebar_label:"Keycloak"},sidebar:"Admin",previous:{title:"Jira",permalink:"/docs/addon_jira_admin"},next:{title:"Kitsu",permalink:"/docs/addon_kitsu_admin"}},r={},c=[{value:"Setting up Keycloak server",id:"setting-up-keycloak-server",level:2},{value:"Create or Re-use a Realm",id:"create-or-re-use-a-realm",level:3},{value:"Creating a client",id:"creating-a-client",level:3},{value:"Client configuration",id:"client-configuration",level:3},{value:"Client Authentication and Secrets",id:"client-authentication-and-secrets",level:3},{value:"Setting up roles",id:"setting-up-roles",level:3},{value:"Identity Providers and User Federation",id:"identity-providers-and-user-federation",level:3}],d={toc:c},u="wrapper";function p(e){let{components:t,...s}=e;return(0,i.kt)(u,(0,n.Z)({},d,s,{components:t,mdxType:"MDXLayout"}),(0,i.kt)("p",null,"Keycloak addon provides SSO for Ayon using Keycloak (",(0,i.kt)("a",{parentName:"p",href:"https://keycloak.org"},"https://keycloak.org"),").\nKeycloak is an open-source IAM server supporting Google SSO, LDAP/AD user federation, 2FA, and more."),(0,i.kt)("p",null,"This addon requires a valid AYON SSO license.\nSee ",(0,i.kt)("a",{parentName:"p",href:"https://ynput.io/ayon/pricing/"},"https://ynput.io/ayon/pricing/")," for more information."),(0,i.kt)("p",null,"This guide outlines the steps to configure a new Keycloak instance for authentication.\nFollow these steps to create a realm, set up a client, configure client settings, and manage user roles."),(0,i.kt)("h2",{id:"setting-up-keycloak-server"},"Setting up Keycloak server"),(0,i.kt)("h3",{id:"create-or-re-use-a-realm"},"Create or Re-use a Realm"),(0,i.kt)("p",null,"Start by creating a new realm for authentication purposes. If a suitable realm already exists,\nyou can re-use it for this setup. "),(0,i.kt)("p",null,"A realm is a basic organizational unit within Keycloak.\nAs Keycloak supports multi-tenancy, a realm can represent a tenant or an organization.\nRealms are completely isolated environments, each with its user database and rules.\nThe master realm should be used only for Keycloak administration."),(0,i.kt)("p",null,"When creating a new realm, you only need to assign it a name."),(0,i.kt)("p",null,(0,i.kt)("img",{alt:"Create realm",src:a(7705).Z,width:"725",height:"541"})),(0,i.kt)("h3",{id:"creating-a-client"},"Creating a client"),(0,i.kt)("p",null,"A client is a single application that uses the authentication service. If a realm represents an organization,\na client represents an Ayon instance. Multiple clients can be configured within a realm,\nfor production and staging instances, or to hard limit access to a particular instance dedicated to a specific project."),(0,i.kt)("p",null,'Navigate to the realm\'s client page and click "Create client".'),(0,i.kt)("p",null,(0,i.kt)("img",{alt:"Create client",src:a(18842).Z,width:"1056",height:"463"})),(0,i.kt)("p",null,'Select "OpenID Connect" as the "Client Protocol".'),(0,i.kt)("p",null,(0,i.kt)("img",{alt:"Create client",src:a(44959).Z,width:"1344",height:"541"})),(0,i.kt)("p",null,'Assign a unique ID to your client in the "Client ID" field. It may be an instance identifier for example. '),(0,i.kt)("p",null,"In Ayon, save this value to the secrets database as ",(0,i.kt)("inlineCode",{parentName:"p"},"keycloak_client_id")," "),(0,i.kt)("h3",{id:"client-configuration"},"Client configuration"),(0,i.kt)("p",null,'After creating the client, enable "Client Authentication" on the next page.\nLeave the other settings at their default values unless specific changes are required for your setup.'),(0,i.kt)("p",null,(0,i.kt)("img",{alt:"Create client",src:a(21167).Z,width:"1040",height:"508"})),(0,i.kt)("p",null,"Add ",(0,i.kt)("inlineCode",{parentName:"p"},"http://yourserver/*"),' to the "Valid Redirect URIs" field.\nThis URI is where Keycloak will send the authentication response. '),(0,i.kt)("p",null,'For "Web Origins", enter the ',(0,i.kt)("inlineCode",{parentName:"p"},"host:port")," format, such as ",(0,i.kt)("inlineCode",{parentName:"p"},"localhost:3000")," or ",(0,i.kt)("inlineCode",{parentName:"p"},"mydomain.example.app"),".\nThis setting specifies the allowed origins for CORS."),(0,i.kt)("p",null,(0,i.kt)("img",{alt:"Create client",src:a(48599).Z,width:"1348",height:"722"})),(0,i.kt)("h3",{id:"client-authentication-and-secrets"},"Client Authentication and Secrets"),(0,i.kt)("p",null,'After setting up the client, go to the "Credentials" tab and create/copy the client secret.\nThis secret is used to authenticate your client with Keycloak. '),(0,i.kt)("p",null,(0,i.kt)("img",{alt:"Secrets",src:a(26158).Z,width:"1087",height:"656"})),(0,i.kt)("p",null,"In Ayon, save it to the secrets database as ",(0,i.kt)("inlineCode",{parentName:"p"},"keycloak_client_secret")),(0,i.kt)("h3",{id:"setting-up-roles"},"Setting up roles"),(0,i.kt)("p",null,'In the "Roles" tab, create roles, that you then be able to map to ayon user levels and access groups'),(0,i.kt)("p",null,(0,i.kt)("img",{alt:"Client roles",src:a(8209).Z,width:"1104",height:"515"})),(0,i.kt)("p",null,'When user logs in, assigned client roles in Keycloak are matched to role mapping settings of the addon\nand if there is a match, Ayon role and Access groups are assigned to the user.\nIf no Keycloak role matches and "Default role" is enabled, the user is assigned the default one.\nIf "Default role" is disabled, the user is denied access to Ayon.'),(0,i.kt)("p",null,"Users are matched using their email address. If the user with the same email already exists in Ayon,\nthe existing account will be used and access rights updated according to Keycloak addon rules.\nOtherwise, a new user is created and the first part of the email address (before @) will be used as their username."),(0,i.kt)("p",null,(0,i.kt)("img",{alt:"Addon settings",src:a(66212).Z,width:"1019",height:"769"})),(0,i.kt)("p",null,"Roles are re-applied every time the user logs in."),(0,i.kt)("h3",{id:"identity-providers-and-user-federation"},"Identity Providers and User Federation"),(0,i.kt)("p",null,"Configure any identity providers (e.g., Google, Facebook) or user federation (e.g., LDAP, Active Directory)\nfor your realm as needed. This allows for authentication using external user databases or social logins."),(0,i.kt)("p",null,"Please refer to Keycloak documentation for more information on configuring\nidentity providers and their mapping to client roles."),(0,i.kt)("p",null,'After restarting the server and logging out, you will see a new "Log in using Keycloak" button on the login page.'))}p.isMDXComponent=!0},66212:(e,t,a)=>{a.d(t,{Z:()=>n});const n=a.p+"assets/images/keycloak-addon-settings-c4d30179677b42e189e7cf10f0b17af3.png"},26158:(e,t,a)=>{a.d(t,{Z:()=>n});const n=a.p+"assets/images/keycloak-client-sercret-4dfb58cd2d16d9d97da8b50484644db4.png"},18842:(e,t,a)=>{a.d(t,{Z:()=>n});const n=a.p+"assets/images/keycloak-create-client-1-42c7b99777f8d8287ee36a176e801a5a.png"},44959:(e,t,a)=>{a.d(t,{Z:()=>n});const n=a.p+"assets/images/keycloak-create-client-2-09f04571642c69dd43ebcee5874b36cc.png"},21167:(e,t,a)=>{a.d(t,{Z:()=>n});const n=a.p+"assets/images/keycloak-create-client-3-c9cb172e24fac9685e32d5c964b7ae15.png"},48599:(e,t,a)=>{a.d(t,{Z:()=>n});const n=a.p+"assets/images/keycloak-create-client-4-87d5ed754fe5fb1b7417ee21a0f744da.png"},7705:(e,t,a)=>{a.d(t,{Z:()=>n});const n=a.p+"assets/images/keycloak-create-realm-0c8aebedc80e4f67008ceed06f8020ef.png"},8209:(e,t,a)=>{a.d(t,{Z:()=>n});const n=a.p+"assets/images/keycloak-roles-9f4e587b3605c064aea953203ab907d4.png"}}]);